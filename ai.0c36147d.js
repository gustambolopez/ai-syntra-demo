lucide.createIcons();let STATE_KEY="syntraai_state",conversations=[],currentConversationId=null,isTyping=!1,isFetching=!1,abortController=null,currentMode="text",settings={temperature:.7,autoSave:!0},sidebar=document.getElementById("sidebar"),sidebarOverlay=document.getElementById("sidebarOverlay"),sidebarToggle=document.getElementById("sidebarToggle"),menuToggle=document.getElementById("menuToggle"),newChatBtn=document.getElementById("newChatBtn"),conversationsList=document.getElementById("conversationsList"),chatBody=document.getElementById("chatBody"),heroSection=document.getElementById("heroSection"),heroInput=document.getElementById("heroInput"),heroSendBtn=document.getElementById("heroSendBtn"),heroModeToggleBtn=document.getElementById("heroModeToggleBtn"),heroModeMenu=document.getElementById("heroModeMenu"),chatInputContainer=document.getElementById("chatInputContainer"),chatInput=document.getElementById("chatInput"),sendBtn=document.getElementById("sendBtn"),modeToggleBtn=document.getElementById("modeToggleBtn"),modeMenu=document.getElementById("modeMenu"),chatTitle=document.getElementById("chatTitle"),editTitleBtn=document.getElementById("editTitleBtn"),appContainer=document.getElementById("appContainer"),settingsBtn=document.getElementById("settingsBtn"),settingsModal=document.getElementById("settingsModal"),closeModalBtn=document.getElementById("closeModalBtn"),tempSlider=document.getElementById("tempSlider"),tempValue=document.getElementById("tempValue"),autoSaveToggle=document.getElementById("autoSaveToggle"),clearAllBtn=document.getElementById("clearAllBtn");function setupModeSelector(e,t){e.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("active")}),t.querySelectorAll(".mode-option").forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation(),currentMode=e.dataset.mode,t.querySelectorAll(".mode-option").forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),t.classList.remove("active")})}),document.addEventListener("click",()=>{t.classList.remove("active")})}function updatePageTitle(e){e&&"New Chat"!==e?document.title=`${e} - SyntraAI`:document.title="SyntraAI"}function updateMenuToggleVisibility(){let e=sidebar.classList.contains("collapsed");menuToggle.style.display=e?"flex":"none"}function toggleSidebar(){let e=sidebar.classList.toggle("collapsed");appContainer.classList.toggle("sidebar-collapsed",e),window.innerWidth<=768&&sidebarOverlay.classList.toggle("active",!e),sidebarToggle.innerHTML=e?'<i data-lucide="panel-left-open" width="20" height="20"></i>':'<i data-lucide="panel-left-close" width="20" height="20"></i>',updateMenuToggleVisibility(),lucide.createIcons()}function createNewConversation(){let e={id:Date.now(),title:"New Chat",messages:[],createdAt:Date.now(),updatedAt:Date.now()};conversations.unshift(e),currentConversationId=e.id,renderConversations(),clearChat(),saveState()}function clearChat(){chatBody.querySelectorAll(".message").forEach(e=>e.remove()),heroSection.classList.remove("hidden"),heroInput.value="",heroSendBtn.disabled=!0,chatInputContainer.style.display="none",chatTitle.textContent="SyntraAI",updatePageTitle(null),editTitleBtn.style.display="none"}function loadConversation(e){let t=conversations.find(t=>t.id===e);t&&(currentConversationId=e,chatBody.querySelectorAll(".message").forEach(e=>e.remove()),0===t.messages.length?(heroSection.classList.remove("hidden"),chatInputContainer.style.display="none",editTitleBtn.style.display="none"):(heroSection.classList.add("hidden"),chatInputContainer.style.display="block",editTitleBtn.style.display="flex",t.messages.forEach(e=>{"image"===e.type?appendImageMessage(e.content,e.prompt):appendMessage(e.content,e.role,!1,!0)})),renderConversations(),chatTitle.textContent=t.title,updatePageTitle(t.title),window.innerWidth<=768&&(sidebar.classList.add("collapsed"),appContainer.classList.add("sidebar-collapsed"),sidebarOverlay.classList.remove("active"),updateMenuToggleVisibility()),setTimeout(()=>{chatBody.scrollTop=chatBody.scrollHeight},100))}function deleteConversation(e,t){t.stopPropagation();let n=conversations.find(t=>t.id===e);n&&confirm(`Delete "${n.title}"?`)&&(conversations=conversations.filter(t=>t.id!==e),currentConversationId===e&&(conversations.length>0?loadConversation(conversations[0].id):createNewConversation()),renderConversations(),saveState(),showToast("Conversation deleted","success"))}function renderConversations(){conversationsList.innerHTML="",[...conversations].sort((e,t)=>t.updatedAt-e.updatedAt).forEach(e=>{let t=document.createElement("div");t.className="conversation-item",e.id===currentConversationId&&t.classList.add("active");let n=document.createElement("span");n.className="conversation-title",n.textContent=e.title;let a=document.createElement("button");a.className="delete-btn",a.innerHTML='<i data-lucide="trash-2" width="16" height="16"></i>',a.onclick=t=>deleteConversation(e.id,t),a.title="Delete conversation",t.appendChild(n),t.appendChild(a),t.addEventListener("click",()=>loadConversation(e.id)),conversationsList.appendChild(t)}),lucide.createIcons()}function appendMessage(e,t,n=!0,a=!1){if(!e)return;let o=document.createElement("div");o.className=`message ${t}-message`;let s=document.createElement("div");s.className="message-avatar",s.innerHTML="user"===t?'<i data-lucide="user" width="18" height="18"></i>':'<i data-lucide="bot" width="18" height="18"></i>';let i=document.createElement("div");i.className="message-content";let r=document.createElement("div");if(r.className="message-text","ai"===t||"assistant"===t?(r.innerHTML=formatMarkdown(e),setTimeout(()=>highlightCode(r),0)):r.textContent=e,i.appendChild(r),("ai"===t||"assistant"===t)&&!a){let e=createMessageActions(r);i.appendChild(e)}return o.appendChild(s),o.appendChild(i),chatBody.appendChild(o),setTimeout(()=>{chatBody.scrollTop=chatBody.scrollHeight},50),lucide.createIcons(),o}function appendImageMessage(e,t){let n=document.createElement("div");n.className="message user-message";let a=document.createElement("div");a.className="message-avatar",a.innerHTML='<i data-lucide="user" width="18" height="18"></i>';let o=document.createElement("div");o.className="message-content";let s=document.createElement("div");s.className="message-text",s.textContent=t,o.appendChild(s),n.appendChild(a),n.appendChild(o),chatBody.appendChild(n);let i=document.createElement("div");i.className="message ai-message image-message";let r=document.createElement("div");r.className="message-avatar",r.innerHTML='<i data-lucide="image" width="18" height="18"></i>';let l=document.createElement("div");l.className="message-content";let d=document.createElement("div");d.className="image-wrapper";let c=document.createElement("img");c.src=e,c.alt=t,c.className="generated-image",c.crossOrigin="anonymous",c.onload=()=>{d.classList.add("loaded")},c.onerror=()=>{d.innerHTML='<div class="image-error">Failed to load image</div>'},d.appendChild(c),l.appendChild(d);let u=document.createElement("div");u.className="message-actions";let g=createActionButton("download","Download",async()=>{try{let t=await fetch(e),n=await t.blob(),a=window.URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=`syntraai-${Date.now()}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a),showToast("Image downloaded","success")}catch(e){showToast("Failed to download image","error")}}),h=createActionButton("link","Copy URL",()=>{copyToClipboard(e)});u.appendChild(g),u.appendChild(h),l.appendChild(u),i.appendChild(r),i.appendChild(l),chatBody.appendChild(i),setTimeout(()=>{chatBody.scrollTop=chatBody.scrollHeight},50),lucide.createIcons()}function createMessageActions(e){let t=document.createElement("div");t.className="message-actions";let n=createActionButton("copy","Copy",()=>{copyToClipboard(e.textContent||e.innerText)}),a=createActionButton("volume-2","Read",()=>{speakText(e.textContent||e.innerText)}),o=createActionButton("refresh-cw","Regenerate",regenerateResponse);return t.appendChild(n),t.appendChild(a),t.appendChild(o),t}function createActionButton(e,t,n){let a=document.createElement("button");return a.className="action-btn",a.innerHTML=`<i data-lucide="${e}" width="16" height="16"></i><span>${t}</span>`,a.addEventListener("click",n),a}function formatMarkdown(e){if(!e)return"";if("string"!=typeof e)try{e=JSON.stringify(e,null,2)}catch{e=String(e)}marked.setOptions({highlight:(e,t)=>{if(!e||"string"!=typeof e)return String(e||"");if(t&&hljs.getLanguage(t))try{return hljs.highlight(e,{language:t}).value}catch{}return hljs.highlightAuto(e).value},breaks:!0,gfm:!0});let t=new marked.Renderer;t.code=e=>{let t,n="",a="";"string"==typeof e?(n=e,a=arguments[1]||""):e&&"object"==typeof e?(n=e.text||e.code||String(e),a=e.lang||e.language||""):n=String(e||"");let o={js:"javascript",jsx:"javascript",ts:"typescript",py:"python",html:"xml",csharp:"cs",sh:"bash",shell:"bash",md:"markdown"}[a?.toLowerCase()]||a?.toLowerCase()||"text";try{t=hljs.getLanguage(o)?hljs.highlight(n,{language:o}).value:hljs.highlightAuto(n).value}catch{t=hljs.highlightAuto(n).value}return`
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">${o.toUpperCase()}</span>
                    <button class="copy-code-btn">
                        <i data-lucide="copy" width="14" height="14"></i>
                        <span>Copy</span>
                    </button>
                </div>
                <pre><code class="language-${o}">${t}</code></pre>
            </div>
        `},t.codespan=e=>{let t="";return t="string"==typeof e?e:e&&"object"==typeof e?e.text||e.code||String(e):String(e||""),`<code class="inline-code">${t}</code>`};try{let n=marked.parse(e,{renderer:t});return"string"==typeof n?n:String(n)}catch(t){return console.error("Markdown parse error:",t),String(e)}}function highlightCode(e){e&&(e.querySelectorAll("pre code").forEach(e=>{try{"string"!=typeof e.textContent&&(e.textContent=String(e.textContent||"")),hljs.highlightElement(e)}catch(e){console.error("Highlight error:",e)}}),e.querySelectorAll(".copy-code-btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.closest(".code-block")?.querySelector("pre code"),n=t?t.innerText:"";n?copyToClipboard(n,e):showToast("Nothing to copy","error")})}),lucide.createIcons())}function copyToClipboard(e,t=null){navigator.clipboard.writeText(e).then(()=>{if(t){let e=t.querySelector("i"),n=t.querySelector("span"),a=e.outerHTML;e.outerHTML='<i data-lucide="check" width="14" height="14"></i>',n.textContent="Copied!",t.classList.add("copied"),lucide.createIcons(),setTimeout(()=>{let e=t.querySelector("i");e&&(e.outerHTML=a),n.textContent="Copy",t.classList.remove("copied"),lucide.createIcons()},2e3)}else showToast("Copied to clipboard","success")}).catch(()=>showToast("Failed to copy","error"))}function speakText(e){if(e&&"string"==typeof e)if("speechSynthesis"in window)try{window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.rate=.9,t.pitch=1,t.onerror=()=>showToast("Speech synthesis failed","error"),window.speechSynthesis.speak(t)}catch(e){console.error("Speech error:",e),showToast("Speech not available","error")}else showToast("Speech synthesis not supported","error")}function showToast(e,t="success"){let n=document.createElement("div");n.className=`toast ${t}`;let a="error"===t?'<i data-lucide="alert-circle" width="18" height="18"></i>':'<i data-lucide="check-circle" width="18" height="18"></i>';n.innerHTML=`${a}<span>${e}</span>`,document.body.appendChild(n),lucide.createIcons(),setTimeout(()=>{n.classList.add("hide"),setTimeout(()=>n.remove(),300)},3e3)}async function sendMessage(e){if(!e.trim()||isFetching)return;heroSection.classList.add("hidden"),chatInputContainer.style.display="block",editTitleBtn.style.display="flex",currentConversationId||createNewConversation();let t=conversations.find(e=>e.id===currentConversationId);if(!t)return;if("image"===currentMode){let n=`https://image.pollinations.ai/prompt/${encodeURIComponent(e)}`;t.messages.push({role:"user",content:n,type:"image",prompt:e}),t.updatedAt=Date.now(),"New Chat"===t.title&&1===t.messages.length&&(t.title=e.substring(0,30)+(e.length>30?"...":""),chatTitle.textContent=t.title,updatePageTitle(t.title),renderConversations()),appendImageMessage(n,e),settings.autoSave&&saveState();return}appendMessage(e,"user",!0,!0),t.messages.push({role:"user",content:e}),t.updatedAt=Date.now(),"New Chat"===t.title&&1===t.messages.length&&(t.title=e.substring(0,30)+(e.length>30?"...":""),chatTitle.textContent=t.title,updatePageTitle(t.title),renderConversations());let n=document.createElement("div");n.className="message ai-message",n.innerHTML=`
        <div class="message-avatar"><i data-lucide="bot" width="18" height="18"></i></div>
        <div class="message-content">
            <div class="thinking-indicator">
                <div class="thinking-dot"></div>
                <div class="thinking-dot"></div>
                <div class="thinking-dot"></div>
            </div>
        </div>
    `,chatBody.appendChild(n),chatBody.scrollTop=chatBody.scrollHeight,lucide.createIcons(),isFetching=!0,sendBtn.disabled=!0,abortController=new AbortController;try{let e=t.messages.slice(-10).filter(e=>"image"!==e.type).map(e=>`${e.role}: ${e.content}`).join("\n"),a=await fetch(`https://text.pollinations.ai/${encodeURIComponent(e)}`,{signal:abortController.signal});if(!a.ok)throw Error(`API error: ${a.status}`);let o=await a.text();if(!o||0===o.trim().length)throw Error("Empty response");n.remove(),appendMessage(o,"ai",!1,!1),t.messages.push({role:"assistant",content:o}),t.updatedAt=Date.now(),settings.autoSave&&saveState()}catch(e){n.remove(),"AbortError"===e.name?showToast("Request cancelled","error"):(console.error("API Error:",e),showToast("Failed to get response. Please try again.","error"),t.messages.pop())}finally{isFetching=!1,sendBtn.disabled=!1,abortController=null}}function regenerateResponse(){let e=conversations.find(e=>e.id===currentConversationId);if(!e||e.messages.length<2)return;e.messages.pop();let t=chatBody.querySelectorAll(".message");t.length>0&&t[t.length-1].remove();let n=e.messages[e.messages.length-1].content;e.messages.pop(),sendMessage(n)}function saveState(){try{let e={conversations,currentConversationId,settings};localStorage.setItem(STATE_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save state:",e),showToast("Failed to save conversations","error")}}function loadState(){try{let e=localStorage.getItem(STATE_KEY);if(e){let t=JSON.parse(e);conversations=t.conversations||[],currentConversationId=t.currentConversationId,tempSlider.value=(settings={...settings,...t.settings||{}}).temperature,tempValue.textContent=settings.temperature.toFixed(1),autoSaveToggle.checked=settings.autoSave,conversations.length>0?(renderConversations(),currentConversationId&&(conversations.find(e=>e.id===currentConversationId)?loadConversation(currentConversationId):createNewConversation())):createNewConversation()}else createNewConversation()}catch(e){console.error("Failed to load state:",e),createNewConversation()}}setupModeSelector(heroModeToggleBtn,heroModeMenu),setupModeSelector(modeToggleBtn,modeMenu),sidebarToggle.addEventListener("click",toggleSidebar),menuToggle.addEventListener("click",toggleSidebar),sidebarOverlay.addEventListener("click",()=>{window.innerWidth<=768&&(sidebar.classList.add("collapsed"),appContainer.classList.add("sidebar-collapsed"),sidebarOverlay.classList.remove("active"),updateMenuToggleVisibility())}),heroInput.addEventListener("input",()=>{heroSendBtn.disabled=!heroInput.value.trim()}),chatInput.addEventListener("input",()=>{chatInput.style.height="auto",chatInput.style.height=Math.min(chatInput.scrollHeight,200)+"px",sendBtn.disabled=!chatInput.value.trim()||isFetching}),heroInput.addEventListener("keydown",e=>{"Enter"!==e.key||heroSendBtn.disabled||(e.preventDefault(),heroSendBtn.click())}),chatInput.addEventListener("keydown",e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),sendBtn.disabled||isFetching||sendBtn.click())}),newChatBtn.addEventListener("click",createNewConversation),editTitleBtn.addEventListener("click",()=>{if(!currentConversationId)return;let e=conversations.find(e=>e.id===currentConversationId);if(!e)return;let t=prompt("Enter new conversation title:",e.title);t&&t.trim()&&(e.title=t.trim(),chatTitle.textContent=e.title,updatePageTitle(e.title),renderConversations(),saveState())}),settingsBtn.addEventListener("click",()=>{settingsModal.classList.add("active")}),closeModalBtn.addEventListener("click",()=>{settingsModal.classList.remove("active")}),settingsModal.addEventListener("click",e=>{e.target===settingsModal&&settingsModal.classList.remove("active")}),tempSlider.addEventListener("input",e=>{settings.temperature=parseFloat(e.target.value),tempValue.textContent=settings.temperature.toFixed(1),saveState()}),autoSaveToggle.addEventListener("change",e=>{settings.autoSave=e.target.checked,saveState()}),clearAllBtn.addEventListener("click",()=>{confirm("Are you sure you want to delete all conversations? This cannot be undone.")&&(conversations=[],currentConversationId=null,createNewConversation(),saveState(),showToast("All conversations cleared","success"),settingsModal.classList.remove("active"))}),heroSendBtn.addEventListener("click",()=>{let e=heroInput.value.trim();e&&(sendMessage(e),heroInput.value="",heroSendBtn.disabled=!0)}),sendBtn.addEventListener("click",()=>{let e=chatInput.value.trim();e&&(sendMessage(e),chatInput.value="",chatInput.style.height="auto",sendBtn.disabled=!0)}),window.addEventListener("beforeunload",()=>{settings.autoSave&&saveState()}),updateMenuToggleVisibility(),loadState();
//# sourceMappingURL=ai.0c36147d.js.map
